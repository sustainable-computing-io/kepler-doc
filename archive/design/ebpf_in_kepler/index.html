
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../metrics/">
      
      
        <link rel="next" href="../kepler-energy-sources/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>eBPF in Kepler - Kepler</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ebpf-in-kepler" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Kepler" class="md-header__button md-logo" aria-label="Kepler" data-md-component="logo">
      
  <img src="../../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kepler
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              eBPF in Kepler
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../zh/archive/design/ebpf_in_kepler/" hreflang="zh" class="md-select__link">
              Chinese
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Kepler" class="md-nav__button md-logo" aria-label="Kepler" data-md-component="logo">
      
  <img src="../../../logo.png" alt="logo">

    </a>
    Kepler
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kepler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kepler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler/installation/guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts/Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Concepts/Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler/usage/power-attribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Power Attribution
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler/usage/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler/design/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Developer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler/developer/dev-docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kepler Operator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Kepler Operator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    OpenShift
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            OpenShift
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler-operator/openshift/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler-operator/openshift/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler-operator/openshift/cli-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler-operator/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler-operator/configuration/monitoring-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring & Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Migration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Migration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../kepler-operator/migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler to PowerMonitor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../project/adopters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adopters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../project/resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../project/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../project/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive (v0.9.0 and below)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Archive (v0.9.0 and below)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Design (Legacy)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Design (Legacy)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../power_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Power Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring Container Power Consumption with Kepler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    eBPF in Kepler
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    eBPF in Kepler
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    <span class="md-ellipsis">
      Background
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Background">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-ebpf" class="md-nav__link">
    <span class="md-ellipsis">
      What is eBPF?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-a-kprobe" class="md-nav__link">
    <span class="md-ellipsis">
      What is a kprobe?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What is a kprobe?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-list-all-currently-registered-kprobes" class="md-nav__link">
    <span class="md-ellipsis">
      How to list all currently registered kprobes?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-cpu-events-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware CPU Events Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware CPU Events Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-check-if-kernel-supports-perf_event_open" class="md-nav__link">
    <span class="md-ellipsis">
      How to check if kernel supports perf_event_open?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-routine-probed-by-kepler" class="md-nav__link">
    <span class="md-ellipsis">
      Kernel Routine Probed by Kepler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-cpu-events-monitored-by-kepler" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware CPU events monitored by Kepler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-process-aka-task-total-cpu-time" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate process (aka task) total CPU time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-task-cpu-cycles" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate task CPU cycles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-task-ref-cpu-cycles" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate task Ref CPU cycles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-task-cpu-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate task CPU instructions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-task-cache-misses" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate task Cache misses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-on-cpu-average-frequency" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate 'On CPU Average Frequency'
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-page-cache-hit" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate 'page cache hit'
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-table" class="md-nav__link">
    <span class="md-ellipsis">
      Process Table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kepler-energy-sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Energy Sources
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation (Legacy)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Installation (Legacy)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/local-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local cluster setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/kepler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy using Manifests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/kepler-helm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy using Helm Chart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/community-operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Community Operator on OpenShift
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/kepler-operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Operator on Kind
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/kepler-rpm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install Kepler as RPM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/Kepler-Telegraf-integration-steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage (Legacy)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Usage (Legacy)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/kepler_daemon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler DaemonSet Customization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/trouble_shooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trouble Shooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/deep_dive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Deep Dive
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hardware Engagement (Legacy)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Hardware Engagement (Legacy)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardwareengagement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware Engagement
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kepler Model Server (Legacy)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Kepler Model Server (Legacy)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../model-server-compatibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compatibility Notice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kepler_model_server/get_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get Started with Kepler Model Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kepler_model_server/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Model Server Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kepler_model_server/pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kepler_model_server/node_profile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node Profile
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kepler_model_server/power_estimation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Power Estimation Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kepler_model_server/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kepler Model Server API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="ebpf-in-kepler">eBPF in Kepler</h1>
<h2 id="background">Background</h2>
<h3 id="what-is-ebpf">What is eBPF?</h3>
<p>eBPF is a revolutionary technology with origins in the Linux kernel that can run sandboxed programs in a privileged context such as the operating system kernel. It is used to safely and efficiently extend the capabilities of the kernel without requiring to change kernel source code or load kernel modules. [1]</p>
<h3 id="what-is-a-kprobe">What is a kprobe?</h3>
<p>KProbes is a debugging mechanism for the Linux kernel which can also be used for monitoring events inside a production system. KProbes enables you to dynamically break into any kernel routine and collect debugging and performance information non-disruptively. You can trap at almost any kernel code address, specifying a handler routine to be invoked when the breakpoint is hit.  [2]</p>
<h4 id="how-to-list-all-currently-registered-kprobes">How to list all currently registered kprobes?</h4>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cat<span class="w"> </span>/sys/kernel/debug/kprobes/list
</code></pre></div>
<h3 id="hardware-cpu-events-monitoring">Hardware CPU Events Monitoring</h3>
<p>Performance counters are special hardware registers available on most modern CPUs. These registers count the number of certain types of hw events: such as instructions executed, cache misses suffered, or branches mis-predicted -without slowing down the kernel or applications. [4]</p>
<p>Using syscall <code>perf_event_open</code> [5], Linux allows to set up performance monitoring for hardware and software performance. It returns a file descriptor to read performance information.
This syscall takes <code>pid</code> and <code>cpuid</code> as parameters. Kepler uses <code>pid == -1</code> and <code>cpuid</code> as actual cpu id.
This combination of pid and cpu allows measuring all process/threads on the specified cpu.</p>
<h4 id="how-to-check-if-kernel-supports-perf_event_open">How to check if kernel supports <code>perf_event_open</code>?</h4>
<p>Check presence of <code>/proc/sys/kernel/perf_event_paranoid</code> to know if kernel supports <code>perf_event_open</code> and what is allowed to be measured</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span>The<span class="w"> </span>perf_event_paranoid<span class="w"> </span>file<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to<span class="w"> </span>restrict
<span class="w">   </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>performance<span class="w"> </span>counters.

<span class="w">   </span><span class="m">2</span><span class="w">      </span>allow<span class="w"> </span>only<span class="w"> </span>user-space<span class="w"> </span>measurements<span class="w"> </span><span class="o">(</span>default<span class="w"> </span>since<span class="w"> </span>Linux<span class="w"> </span><span class="m">4</span>.6<span class="o">)</span>.
<span class="w">   </span><span class="m">1</span><span class="w">      </span>allow<span class="w"> </span>both<span class="w"> </span>kernel<span class="w"> </span>and<span class="w"> </span>user<span class="w"> </span>measurements<span class="w"> </span><span class="o">(</span>default<span class="w"> </span>before<span class="w"> </span>Linux<span class="w"> </span><span class="m">4</span>.6<span class="o">)</span>.
<span class="w">   </span><span class="m">0</span><span class="w">      </span>allow<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>CPU-specific<span class="w"> </span>data<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>raw<span class="w"> </span>tracepoint<span class="w"> </span>samples.
<span class="w">  </span>-1<span class="w">      </span>no<span class="w"> </span>restrictions.


<span class="w">   </span>Measuring<span class="w"> </span>all<span class="w"> </span>process/threads<span class="w"> </span>required<span class="w"> </span>CAP_SYS_ADMIN<span class="w"> </span>capability<span class="w"> </span>or<span class="w"> </span>a<span class="w"> </span>value<span class="w"> </span>less<span class="w"> </span>than<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>above<span class="w"> </span>file
</code></pre></div>
<p><strong>CAP_SYS_ADMIN</strong> is highest level of capability, it must have some security implications</p>
<h2 id="kernel-routine-probed-by-kepler">Kernel Routine Probed by Kepler</h2>
<p>Kepler traps into <code>finish_task_switch</code> kernel function [3], which is responsible for cleaning up after a task switch occurs. Since the probe is <code>kprobe</code> it is called before <code>finish_task_switch</code> is called (instead of a <code>kretprobe</code> which is called after the probed function returns).</p>
<p>When a context switch occurs inside the kernel, the function <code>finish_task_switch</code> is called on the new task which is going to use the CPU. This function receives an argument of type <code>task_struct*</code> which contains all the information about the task which is leaving the CPU.[3]</p>
<p>The probe function in Kepler is</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">kprobe__finish_task_switch</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="p">)</span>
</code></pre></div>
<p>The first argument is of type pointer to a <code>pt_regs</code> struct which refers to the structure that holds the register state of the CPU at the time of the kernel function entry. This struct contains fields that correspond to the CPU registers, such as general-purpose registers (e.g., r0, r1, etc.), stack pointer (sp), program counter (pc), and other architectural-specific registers.
The second argument is a pointer to a <code>task_struct</code> which contains the task information for the previous task, i.e. the task which is leaving the CPU.</p>
<h2 id="hardware-cpu-events-monitored-by-kepler">Hardware CPU events monitored by Kepler</h2>
<p>Kepler opens monitoring for following hardware cpu events</p>
<table>
<thead>
<tr>
<th>PERF Type</th>
<th>Perf Count Type</th>
<th>Description</th>
<th>Array name <br>(in bpf program)</th>
</tr>
</thead>
<tbody>
<tr>
<td>PERF_TYPE_HARDWARE</td>
<td>PERF_COUNT_HW_CPU_CYCLES</td>
<td>Total CPU cycles; can get affected by CPU frequency scaling</td>
<td>cpu_cycles_hc_reader</td>
</tr>
<tr>
<td>PERF_TYPE_HARDWARE</td>
<td>PERF_COUNT_HW_REF_CPU_CYCLES</td>
<td>Total CPU cycles; not affected by CPU frequency scaling</td>
<td>cpu_ref_cycles_hc_reader</td>
</tr>
<tr>
<td>PERF_TYPE_HARDWARE</td>
<td>PERF_COUNT_HW_INSTRUCTIONS</td>
<td>Retired instructions.  Be careful, these can be affected by various issues, most notably hardware interrupt counts.</td>
<td>cpu_instr_hc_reader</td>
</tr>
<tr>
<td>PERF_TYPE_HARDWARE</td>
<td>PERF_COUNT_HW_CACHE_MISSES</td>
<td>Cache misses. Usually this indicates Last Level Cache misses; this is intended to be used in conjunction with the PERF_COUNT_HW_CACHE_REFERENCES event to calculate cache miss rates.</td>
<td>cache_miss_hc_reader</td>
</tr>
</tbody>
</table>
<p>Performance counters are accessed via special file descriptors. There's one file descriptor per virtual counter used. The file descriptor is associated with the corresponding array. When bcc wrapper functions are used, it reads the corresponding fd, and return values.</p>
<h2 id="calculate-process-aka-task-total-cpu-time">Calculate process (aka task) total CPU time</h2>
<p>The ebpf program (<code>bpfassets/bcc/bcc.c</code>) maintains a mapping from a <code>&lt;pid, cpuid&gt;</code> pair to a timestamp. The timestamp signifies the moment <code>kprobe__finish_task_switch</code> was called for pid when this pid was to be scheduled on cpu <code>&lt;cpuid&gt;</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// &lt;Task PID, CPUID&gt; =&gt; Context Switch Start time</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pid_time_t</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">cpu</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">pid_time_t</span><span class="p">;</span>
<span class="n">BPF_HASH</span><span class="p">(</span><span class="n">pid_time</span><span class="p">,</span><span class="w"> </span><span class="n">pid_time_t</span><span class="p">);</span>
<span class="c1">// pid_time is the name of variable which if of type map</span>
</code></pre></div>
<p>Within the function <code>get_on_cpu_time</code>, the difference between the current timestamp and timestamp from the <code>pid_time</code> map is used to calculate the <code>on_cpu_time_delta</code> for previous task on the current cpu.</p>
<p>This <code>on_cpu_time_delta</code> is used to accumulate the <code>process_run_time</code> metrics for the previous task.</p>
<h2 id="calculate-task-cpu-cycles">Calculate task CPU cycles</h2>
<p>For task cpu cycles, the bpf program maintains an array named <code>cpu_cycles</code>, indexed by <code>cpuid</code>. This contains values from perf array <code>cpu_cycles_hc_reader</code>, which is a perf event type array.</p>
<p>On each task switch:</p>
<ul>
<li>current value is read from perf counter array cpu_cycles_hc_reader</li>
<li>the previous value from cpu_cycles is retrieved</li>
<li>delta is calculated by subtracting prev value from current value</li>
<li>the current value is copied back to cpu_cycles for next task switch</li>
</ul>
<p>The delta thus calculated is the cpu cycles used by the process leaving the cpu</p>
<h2 id="calculate-task-ref-cpu-cycles">Calculate task Ref CPU cycles</h2>
<p>Same process as calculating CPU cycles, difference being perf array used is <code>cpu_ref_cycles_hc_reader</code> and prev value is stored in <code>cpu_ref_cycles</code></p>
<h2 id="calculate-task-cpu-instructions">Calculate task CPU instructions</h2>
<p>Same process as calculating CPU cycles, difference being perf array used is <code>cpu_instr_hc_reader</code> and prev value is stored in <code>cpu_instr</code></p>
<h2 id="calculate-task-cache-misses">Calculate task Cache misses</h2>
<p>Same process as calculating CPU cycles, difference being perf array used is <code>cache_miss_hc_reader</code> and prev value is stored in <code>cache_miss</code></p>
<h2 id="calculate-on-cpu-average-frequency">Calculate 'On CPU Average Frequency'</h2>
<div class="highlight"><pre><span></span><code><span class="n">avg_freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">on_cpu_cycles_delta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CPU_REF_FREQ</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">on_cpu_ref_cycles_delta</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">HZ</span><span class="p">;</span>

<span class="n">CPU_REF_FREQ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2500</span>
<span class="n">HZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span>
</code></pre></div>
<p>This value is stored in array <code>cpu_freq_array</code></p>
<h2 id="calculate-page-cache-hit">Calculate 'page cache hit'</h2>
<p>The probe function in Kepler <code>kprobe__set_page_dirty</code> and <code>kprobe__mark_page_accessed</code> are used to track page cache hit for write and read action respectively.</p>
<h2 id="process-table">Process Table</h2>
<p>The bpf program maintains a bpf hash named <code>processes</code>. This hash maintains data calculated for a process. Kepler reads values from this hash ( known as a <code>Table</code> in bcc ) and generates metrics.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>pid</td>
<td>cgroupid</td>
<td>Process CGroupID</td>
</tr>
<tr>
<td></td>
<td>pid</td>
<td>Process ID</td>
</tr>
<tr>
<td></td>
<td>process_run_time</td>
<td>Total time a process occupies CPU (calculated each time process leaves CPU on context switch)</td>
</tr>
<tr>
<td></td>
<td>cpu_cycles</td>
<td>Total CPU cycles consumed by process</td>
</tr>
<tr>
<td></td>
<td>cpu_instr</td>
<td>Total CPU instructions consumed by process</td>
</tr>
<tr>
<td></td>
<td>cache_miss</td>
<td>Total Cache miss by process</td>
</tr>
<tr>
<td></td>
<td>page_cache_hit</td>
<td>Total hit of the page cache</td>
</tr>
<tr>
<td></td>
<td>vec_nr</td>
<td>Total number of soft irq handles by process (max 10)</td>
</tr>
<tr>
<td></td>
<td>comm</td>
<td>Process name (max length 16)</td>
</tr>
</tbody>
</table>
<p>This hash is read by the kernel collector in <code>container_hc_collector.go</code> for metrics collection.</p>
<h2 id="references">References</h2>
<p>[1] <a href="https://ebpf.io/what-is-ebpf/">https://ebpf.io/what-is-ebpf/</a> , <a href="https://www.splunk.com/en_us/blog/learn/what-is-ebpf.html">https://www.splunk.com/en_us/blog/learn/what-is-ebpf.html</a> , <a href="https://www.tigera.io/learn/guides/ebpf/">https://www.tigera.io/learn/guides/ebpf/</a></p>
<p>[2] <a href="https://lwn.net/Articles/132196/">An introduction to KProbes</a> , <a href="https://docs.kernel.org/trace/kprobes.html">Kernel Probes (Kprobes)</a></p>
<p>[3] <a href="https://elixir.bootlin.com/linux/v6.4-rc7/source/kernel/sched/core.c#L5157">finish_task_switch - clean up after a task-switch</a></p>
<p>[4] <a href="https://elixir.bootlin.com/linux/latest/source/tools/perf/design.txt">Performance Counters for Linux</a></p>
<p>[5] <a href="https://www.man7.org/linux/man-pages/man2/perf_event_open.2.html">perf_event_open(2) — Linux manual page</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <html>
    <body>
        <p style="text-align:center;font-size:15px;">
            Copyright Contributors to the Kepler's project.
        </p>
        <p style="text-align:center;font-size:20px;color:#4169E1;">
        The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank"> Trademark Usage.</a>
        </p>
    </body>

</html>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.footer", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "v0.4"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>